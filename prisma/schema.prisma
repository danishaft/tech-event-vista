generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Event {
  id                   String    @id @default(cuid())
  title                String
  description          String?
  eventType            String
  status               String    @default("active")
  eventDate            DateTime
  eventEndDate         DateTime?
  venueName            String?
  venueAddress         String?
  city                 String
  country              String    @default("US")
  isOnline             Boolean   @default(false)
  isFree               Boolean   @default(false)
  priceMin             Float?
  priceMax             Float?
  currency             String    @default("USD")
  organizerName        String?
  organizerDescription String?
  organizerRating      Float?
  capacity             Int?
  registeredCount      Int       @default(0)
  techStack            String[]
  qualityScore         Float     @default(0)
  completenessScore    Float     @default(0)
  externalUrl          String?
  imageUrl             String?
  sourcePlatform       String
  sourceId             String
  scrapedAt            DateTime  @default(now())
  lastUpdated          DateTime  @updatedAt
  createdAt            DateTime  @default(now())
  
  dataEnriched         Boolean   @default(false)
  enrichmentAttempts  Int       @default(0)
  topics               String[]
  audienceLevel        String?
  format               String?
  summary              String?
  keyPoints            String[]
  
  organizerUrl         String?
  
  latitude            Float?
  longitude           Float?
  timezone            String?

  savedEvents     SavedEvent[]
  eventCategories EventCategory[]

  @@unique([sourcePlatform, sourceId])
  @@index([city])
  @@index([eventDate])
  @@index([eventType])
  @@index([techStack])
  @@index([status])
  @@index([qualityScore])
  @@index([title, eventDate, city], name: "idx_title_date_city")
  @@index([externalUrl], name: "idx_external_url")
  @@index([status, city, eventDate], name: "idx_status_city_date")
  @@index([status, eventDate], name: "idx_status_date")
}

model User {
  id              String   @id @default(cuid())
  email           String   @unique
  firstName       String?
  lastName        String?
  profileImageUrl String?
  preferences     Json?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  savedEvents SavedEvent[]
}

model SavedEvent {
  id      String   @id @default(cuid())
  userId  String
  eventId String
  savedAt DateTime @default(now())
  notes   String?

  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([userId, eventId])
  @@index([userId])
}

model EventCategory {
  id         String @id @default(cuid())
  eventId    String
  category   String
  value      String
  confidence Float  @default(1.0)

  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([eventId, category, value])
  @@index([category])
}

model ScrapingJob {
  id            String    @id @default(cuid())
  platform      String
  status        String
  query         String?
  city          String?
  platforms     String[]
  startedAt     DateTime?
  completedAt   DateTime?
  errorMessage  String?
  eventsScraped Int       @default(0)
  createdAt     DateTime  @default(now())

  @@index([platform])
  @@index([status])
  @@index([createdAt])
  @@index([query])
}
