// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Event {
  id                String   @id @default(cuid())
  title             String
  description       String?
  eventType         String   // workshop, conference, meetup, hackathon
  status            String   @default("active") // active, cancelled, sold_out
  eventDate         DateTime
  eventEndDate      DateTime?
  venueName         String?
  venueAddress      String?
  city              String
  country           String   @default("US")
  isOnline          Boolean  @default(false)
  isFree            Boolean  @default(false)
  priceMin          Float?
  priceMax          Float?
  currency          String   @default("USD")
  organizerName     String?
  organizerDescription String?
  organizerRating   Float?
  capacity          Int?
  registeredCount   Int      @default(0)
  techStack         String[] // Array of technologies
  qualityScore      Float    @default(0)
  externalUrl       String?
  imageUrl          String?
  sourcePlatform    String   // eventbrite, meetup, luma
  sourceId          String   // Original ID from source platform
  scrapedAt         DateTime @default(now())
  lastUpdated       DateTime @updatedAt
  createdAt         DateTime @default(now())

  // Relations
  savedEvents       SavedEvent[]
  eventCategories   EventCategory[]

  @@unique([sourcePlatform, sourceId])
  @@index([city])
  @@index([eventDate])
  @@index([eventType])
  @@index([techStack])
}

model User {
  id                String   @id @default(cuid())
  clerkId           String   @unique
  email             String   @unique
  firstName         String?
  lastName          String?
  profileImageUrl   String?
  preferences       Json?    // User preferences as JSON
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  savedEvents       SavedEvent[]

  @@index([clerkId])
}

model SavedEvent {
  id        String   @id @default(cuid())
  userId    String
  eventId   String
  savedAt   DateTime @default(now())
  notes     String?

  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([userId, eventId])
  @@index([userId])
}

model EventCategory {
  id          String   @id @default(cuid())
  eventId     String
  category    String   // technology, event_type, etc.
  value       String   // react, conference, etc.
  confidence  Float    @default(1.0)

  // Relations
  event       Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@unique([eventId, category, value])
  @@index([category])
}

model ScrapingJob {
  id          String   @id @default(cuid())
  platform    String   // eventbrite, meetup, luma
  status      String   // pending, running, completed, failed
  startedAt   DateTime?
  completedAt DateTime?
  errorMessage String?
  eventsScraped Int    @default(0)
  createdAt   DateTime @default(now())

  @@index([platform])
  @@index([status])
  @@index([createdAt])
}
